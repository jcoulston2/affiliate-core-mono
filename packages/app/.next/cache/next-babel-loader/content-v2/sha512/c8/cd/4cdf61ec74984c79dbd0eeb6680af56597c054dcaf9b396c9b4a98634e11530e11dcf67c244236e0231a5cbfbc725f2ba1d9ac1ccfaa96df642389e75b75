{"ast":null,"code":"import _defineProperty from \"/Users/justincoulston/Desktop/affilaite-core-mono/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/justincoulston/Desktop/affilaite-core-mono/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { SEARCH_PATH, PLP_PATH, INVALID_FILTER_PATH } from '@constants';\nimport { isStringInt, navigateToPageRefresh } from '@helpers/common';\nimport { getSearchQueryFromUrl } from '@helpers/page';\nimport camelCase from 'lodash/camelCase';\nvar validFilters = ['price-sort', 'price-threshold-low', 'price-threshold-high', 'key-words', 'sale-threshold', 'brands', 'section', 'category'];\nexport function toFilterArray(str) {\n  return str.replace(/\\s/g, '').split('&');\n}\nexport function normalizeFilterValue(value) {\n  if (value.includes(',')) {\n    return value.split(',');\n  } else if (isStringInt(value)) {\n    return parseInt(value);\n  } else {\n    return value;\n  }\n}\nexport function getFilterValues(filterkey, filterValues) {\n  if (filterkey === 'filter' && filterValues) {\n    return toFilterArray(filterValues).reduce(function (acc, cur) {\n      var _cur$split = cur.split('='),\n          _cur$split2 = _slicedToArray(_cur$split, 2),\n          key = _cur$split2[0],\n          value = _cur$split2[1];\n\n      return validFilters.includes(key) ? _objectSpread(_objectSpread({}, acc), {}, _defineProperty({}, camelCase(key), normalizeFilterValue(value))) : acc;\n    }, {});\n  } else if (!filterkey) {\n    return {};\n  } else {\n    throw INVALID_FILTER_PATH;\n  }\n}\nexport function getFilterValuesFromSearchUrl(searchTerms) {\n  return Object.keys(searchTerms).reduce(function (acc, cur) {\n    var value = normalizeFilterValue(searchTerms[cur]);\n    return validFilters.includes(cur) ? _objectSpread(_objectSpread({}, acc), {}, _defineProperty({}, camelCase(cur), value)) : acc;\n  }, {});\n}\nexport function getFiltersFromUrl() {\n  if (false) return null;\n\n  var _ref = window.location.href.match(/\\/filter\\/(.*)|\\/params?(.*)/g) || [],\n      _ref2 = _slicedToArray(_ref, 1),\n      filterMatch = _ref2[0];\n\n  var urlFilterValues = filterMatch && filterMatch.replace(/\\/filter\\/|\\/params\\?/, '');\n  return urlFilterValues ? getFilterValues('filter', urlFilterValues) : null;\n}\nexport function getFilterPlpBasePath(router) {\n  var isSearchPage = router.pathname.includes(SEARCH_PATH);\n\n  if (isSearchPage) {\n    return \"/\".concat(SEARCH_PATH).concat(getSearchQueryFromUrl(router));\n  } else {\n    var _router$query$slug = _slicedToArray(router.query.slug, 2),\n        section = _router$query$slug[0],\n        productType = _router$query$slug[1];\n\n    return \"/\".concat(PLP_PATH, \"/\").concat(section, \"/\").concat(productType, \"/filter/\");\n  }\n}\nexport function pushFilterPlpBasePath(router) {\n  var basePath = getFilterPlpBasePath(router);\n  navigateToPageRefresh(basePath);\n}","map":{"version":3,"sources":["/Users/justincoulston/Desktop/affilaite-core-mono/packages/app/helpers/page/filters.js"],"names":["SEARCH_PATH","PLP_PATH","INVALID_FILTER_PATH","isStringInt","navigateToPageRefresh","getSearchQueryFromUrl","camelCase","validFilters","toFilterArray","str","replace","split","normalizeFilterValue","value","includes","parseInt","getFilterValues","filterkey","filterValues","reduce","acc","cur","key","getFilterValuesFromSearchUrl","searchTerms","Object","keys","getFiltersFromUrl","window","location","href","match","filterMatch","urlFilterValues","getFilterPlpBasePath","router","isSearchPage","pathname","query","slug","section","productType","pushFilterPlpBasePath","basePath"],"mappings":";;;;;;;AACA,SAASA,WAAT,EAAsBC,QAAtB,EAAgCC,mBAAhC,QAA2D,YAA3D;AACA,SAASC,WAAT,EAAsBC,qBAAtB,QAAmD,iBAAnD;AACA,SAASC,qBAAT,QAAsC,eAAtC;AAGA,OAAOC,SAAP,MAAsB,kBAAtB;AAQA,IAAMC,YAAY,GAAG,CACnB,YADmB,EAEnB,qBAFmB,EAGnB,sBAHmB,EAInB,WAJmB,EAKnB,gBALmB,EAMnB,QANmB,EAOnB,SAPmB,EAQnB,UARmB,CAArB;AAWA,OAAO,SAASC,aAAT,CAAuBC,GAAvB,EAAmD;AACxD,SAAOA,GAAG,CAACC,OAAJ,CAAY,KAAZ,EAAmB,EAAnB,EAAuBC,KAAvB,CAA6B,GAA7B,CAAP;AACD;AAED,OAAO,SAASC,oBAAT,CAA8BC,KAA9B,EAA8E;AACnF,MAAIA,KAAK,CAACC,QAAN,CAAe,GAAf,CAAJ,EAAyB;AACvB,WAAOD,KAAK,CAACF,KAAN,CAAY,GAAZ,CAAP;AACD,GAFD,MAEO,IAAIR,WAAW,CAACU,KAAD,CAAf,EAAwB;AAC7B,WAAOE,QAAQ,CAACF,KAAD,CAAf;AACD,GAFM,MAEA;AACL,WAAOA,KAAP;AACD;AACF;AAED,OAAO,SAASG,eAAT,CAAyBC,SAAzB,EAA+CC,YAA/C,EAA8E;AACnF,MAAID,SAAS,KAAK,QAAd,IAA0BC,YAA9B,EAA4C;AAC1C,WAAOV,aAAa,CAACU,YAAD,CAAb,CAA4BC,MAA5B,CAAmC,UAACC,GAAD,EAAMC,GAAN,EAAc;AAAA,uBACnCA,GAAG,CAACV,KAAJ,CAAU,GAAV,CADmC;AAAA;AAAA,UACjDW,GADiD;AAAA,UAC5CT,KAD4C;;AAEtD,aAAON,YAAY,CAACO,QAAb,CAAsBQ,GAAtB,oCACEF,GADF,2BACQd,SAAS,CAACgB,GAAD,CADjB,EACyBV,oBAAoB,CAACC,KAAD,CAD7C,KAEHO,GAFJ;AAGD,KALM,EAKJ,EALI,CAAP;AAMD,GAPD,MAOO,IAAI,CAACH,SAAL,EAAgB;AACrB,WAAO,EAAP;AACD,GAFM,MAEA;AACL,UAAMf,mBAAN;AACD;AACF;AAED,OAAO,SAASqB,4BAAT,CAAsCC,WAAtC,EAA+E;AACpF,SAAOC,MAAM,CAACC,IAAP,CAAYF,WAAZ,EAAyBL,MAAzB,CAAwC,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC3D,QAAMR,KAAK,GAAGD,oBAAoB,CAACY,WAAW,CAACH,GAAD,CAAZ,CAAlC;AACA,WAAOd,YAAY,CAACO,QAAb,CAAsBO,GAAtB,oCAAkCD,GAAlC,2BAAwCd,SAAS,CAACe,GAAD,CAAjD,EAAyDR,KAAzD,KAAmEO,GAA1E;AACD,GAHM,EAGJ,EAHI,CAAP;AAID;AAED,OAAO,SAASO,iBAAT,GAAuC;AAC5C,aAAmC,OAAO,IAAP;;AADS,aAEtBC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,KAArB,CAA2B,+BAA3B,KAA+D,EAFzC;AAAA;AAAA,MAErCC,WAFqC;;AAG5C,MAAMC,eAAe,GAAGD,WAAW,IAAIA,WAAW,CAACtB,OAAZ,CAAoB,uBAApB,EAA6C,EAA7C,CAAvC;AACA,SAAOuB,eAAe,GAAGjB,eAAe,CAAC,QAAD,EAAWiB,eAAX,CAAlB,GAAgD,IAAtE;AACD;AAED,OAAO,SAASC,oBAAT,CAA8BC,MAA9B,EAAsD;AAC3D,MAAMC,YAAY,GAAGD,MAAM,CAACE,QAAP,CAAgBvB,QAAhB,CAAyBd,WAAzB,CAArB;;AACA,MAAIoC,YAAJ,EAAkB;AAChB,sBAAWpC,WAAX,SAAyBK,qBAAqB,CAAC8B,MAAD,CAA9C;AACD,GAFD,MAEO;AAAA,4CAC0BA,MAAM,CAACG,KAAP,CAAaC,IADvC;AAAA,QACEC,OADF;AAAA,QACWC,WADX;;AAEL,sBAAWxC,QAAX,cAAuBuC,OAAvB,cAAkCC,WAAlC;AACD;AACF;AAED,OAAO,SAASC,qBAAT,CAA+BP,MAA/B,EAAqD;AAC1D,MAAMQ,QAAQ,GAAGT,oBAAoB,CAACC,MAAD,CAArC;AACA/B,EAAAA,qBAAqB,CAACuC,QAAD,CAArB;AACD","sourcesContent":["//@flow\nimport { SEARCH_PATH, PLP_PATH, INVALID_FILTER_PATH } from '@constants';\nimport { isStringInt, navigateToPageRefresh } from '@helpers/common';\nimport { getSearchQueryFromUrl } from '@helpers/page';\nimport { type Filters } from '@types/product';\nimport { type SearchUrlCase } from '@types/search';\nimport camelCase from 'lodash/camelCase';\nimport { type Router } from '@types/next';\n\ntype SearchAndFilters = {\n  ...SearchUrlCase,\n  ...Filters,\n};\n\nconst validFilters = [\n  'price-sort',\n  'price-threshold-low',\n  'price-threshold-high',\n  'key-words',\n  'sale-threshold',\n  'brands',\n  'section',\n  'category',\n];\n\nexport function toFilterArray(str: string): Array<string> {\n  return str.replace(/\\s/g, '').split('&');\n}\n\nexport function normalizeFilterValue(value: string): string | Array<string> | number {\n  if (value.includes(',')) {\n    return value.split(',');\n  } else if (isStringInt(value)) {\n    return parseInt(value);\n  } else {\n    return value;\n  }\n}\n\nexport function getFilterValues(filterkey: ?'filter', filterValues: ?string): Object {\n  if (filterkey === 'filter' && filterValues) {\n    return toFilterArray(filterValues).reduce((acc, cur) => {\n      let [key, value] = cur.split('=');\n      return validFilters.includes(key)\n        ? { ...acc, [camelCase(key)]: normalizeFilterValue(value) }\n        : acc;\n    }, {});\n  } else if (!filterkey) {\n    return {};\n  } else {\n    throw INVALID_FILTER_PATH;\n  }\n}\n\nexport function getFilterValuesFromSearchUrl(searchTerms: SearchAndFilters): ?Filters {\n  return Object.keys(searchTerms).reduce<Object>((acc, cur) => {\n    const value = normalizeFilterValue(searchTerms[cur]);\n    return validFilters.includes(cur) ? { ...acc, [camelCase(cur)]: value } : acc;\n  }, {});\n}\n\nexport function getFiltersFromUrl(): ?Filters {\n  if (typeof window === 'undefined') return null;\n  const [filterMatch] = window.location.href.match(/\\/filter\\/(.*)|\\/params?(.*)/g) || [];\n  const urlFilterValues = filterMatch && filterMatch.replace(/\\/filter\\/|\\/params\\?/, '');\n  return urlFilterValues ? getFilterValues('filter', urlFilterValues) : null;\n}\n\nexport function getFilterPlpBasePath(router: Router): string {\n  const isSearchPage = router.pathname.includes(SEARCH_PATH);\n  if (isSearchPage) {\n    return `/${SEARCH_PATH}${getSearchQueryFromUrl(router)}`;\n  } else {\n    const [section, productType] = router.query.slug;\n    return `/${PLP_PATH}/${section}/${productType}/filter/`;\n  }\n}\n\nexport function pushFilterPlpBasePath(router: Router): void {\n  const basePath = getFilterPlpBasePath(router);\n  navigateToPageRefresh(basePath);\n}\n"]},"metadata":{},"sourceType":"module"}